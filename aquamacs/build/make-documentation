#! /usr/bin/tclsh


proc makePDF {} {
    global fname
    set fname $::argv
    set suffix tex
    if {[string range $fname end-2 end] != $suffix} {
	puts "Please select a LaTeX file."
	exit
    } else {
	puts "Running pdflatex on $fname..."
	catch {exec pdflatex -interaction=nonstopmode $fname}
	puts "Running pdflatex again to update references..."
	catch {exec pdflatex -interaction=nonstopmode $fname}
	set newpdf [string replace $fname end-2 end pdf]
	puts "Opening $newpdf..."
	exec open $newpdf
    }
}


proc makeHTML {} {
    global fname
    set fname $::argv

    puts "Running latex2html on $fname..."
    catch {exec latex2html -local_icons -html_version=4.1 $fname}
    puts "$fname converted to HTML."
    set newdir [string replace $fname end-3 end]
    puts $newdir
    set newcss [string replace $fname end-2 end css]
    file copy -force $newcss $newdir/$newcss
    puts "Applying Apple Help tags..."
    set phrase  {<META NAME="description" CONTENT="Aquamacs User Help">}

    set newphrase  {
	<META NAME="description" CONTENT="Aquamacs User Help">
	<META NAME="AppleTitle" content="Aquamacs User Help">
	<META NAME="AppleFont" content="Lucida Grande,Helvetica">
    }
    set oldindex [open $newdir/index.html r]
    set contents [read $oldindex]
    close $oldindex
    regsub $phrase $contents $newphrase contents
    set newindex [open $newdir/index.html w]
    puts -nonewline $newindex $contents
    close $newindex
    puts "Apple Help tags applied..."
    puts "Opening $newdir/index.html..."
    exec open $newdir/index.html
}


makePDF
makeHTML