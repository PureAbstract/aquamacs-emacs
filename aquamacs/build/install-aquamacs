#!/bin/sh

# copies build from Aquamacs-Raw folder
# should be called AFTER building in order to install Aquamacs
 
# this takes three optional arguments   

projdir=$1   # project-dir (Aquamacs CVS)
dest=$2      # destination, e.g. "/Applications/Aquamacs Emacs.app"
SRC=$3       # Emacs build, e.g. /Users/dr/Projects/emacs/mac/Aquamacs-Raw/Emacs.app



if [ ! $dest ]; then

    dest="/Applications/Aquamacs Emacs.app"
    
fi

if [ ! $projdir ]; then

    # project directory (out of Aquamacs CVS)
    projdir=`pwd`/../../Aquamacs/aquamacs

fi


if [ ! $SRC ]; then

# where the Emacs build is
    SRC=`pwd`/Aquamacs-Raw/Emacs.app


fi

echo "Destination App (e.g. /Applications/Aquamacs.app): $dest"
echo "Project CVS Dir (e.g. ~/Proj/aquamacs): $projdir"
echo "Source Dir (e.g. Aquamacs-Raw/Emacs.app): $SRC"
 
# copy-to-app script
CSCRIPT=$projdir/build/copy-to-app


# install elisp files etc in $SRC
#  -n --> do not compile
$CSCRIPT -n "$projdir" "$SRC"

bak=/tmp/aquamacs-backup.`date +"%H%M%S"`
mkdir $bak 2>/dev/null
mv "$dest" $bak/ 


# move to Applications
mv "$SRC" "$dest"


mv "$dest/Contents/MacOS/Emacs" "$dest/Contents/MacOS/Aquamacs Emacs"
cd "$dest/Contents/MacOS/"; ln -s "Aquamacs Emacs" "Emacs"




