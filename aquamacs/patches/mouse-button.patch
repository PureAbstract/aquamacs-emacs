Index: src/macterm.c
===================================================================
RCS file: /cvsroot/emacs/emacs/src/macterm.c,v
retrieving revision 1.145
diff -c -r1.145 macterm.c
*** src/macterm.c	24 Nov 2005 08:20:16 -0000	1.145
--- src/macterm.c	26 Nov 2005 11:19:29 -0000
***************
*** 8222,8232 ****
  {
    int result = 0;
    if (!NILP (Vmac_emulate_three_button_mouse)) {
!     int cmdIs3 = !EQ (Vmac_emulate_three_button_mouse, Qreverse);
!     if (modifiers & cmdKey)
!       result = cmdIs3 ? 2 : 1;
!     else if (modifiers & optionKey)
!       result = cmdIs3 ? 1 : 2;
    }
    return result;
  }
--- 8222,8242 ----
  {
    int result = 0;
    if (!NILP (Vmac_emulate_three_button_mouse)) {
!     if (EQ (Vmac_emulate_three_button_mouse, Qreverse))
!       {
! 	result = (modifiers & optionKey) ? ((modifiers & cmdKey) ? 3 : 2) : 
! 	  ((modifiers & cmdKey) ? 1 : 0);
!       }
!     else if (EQ (Vmac_emulate_three_button_mouse, Qcontrol))
!       {
! 	result = (modifiers & controlKey) ? ((modifiers & cmdKey) ? 3 : 2) : 
! 	  ((modifiers & cmdKey) ? 1 : 0);
!       }
!     else 
!       {
! 	result = (modifiers & optionKey) ? ((modifiers & cmdKey) ? 3 : 1) : 
! 	  ((modifiers & cmdKey) ? 2 : 0);
!       }
    }
    return result;
  }
***************
*** 8243,8249 ****
    if (!NILP (Vmac_emulate_three_button_mouse) &&
        GetEventClass(eventRef) == kEventClassMouse)
      {
!       mods &= ~(optionKey | cmdKey);
      }
    return mac_to_emacs_modifiers (mods);
  }
--- 8253,8268 ----
    if (!NILP (Vmac_emulate_three_button_mouse) &&
        GetEventClass(eventRef) == kEventClassMouse)
      {
!       /* Only for a true mouse-1 */
!       EventMouseButton button = kEventMouseButtonPrimary;
!       GetEventParameter (eventRef, kEventParamMouseButton, 
! 			 typeMouseButton, NULL,
! 			 sizeof (EventMouseButton), NULL, &button);
!       if (button == kEventMouseButtonPrimary) 
! 	{
! 	  mods &= ~(((EQ (Vmac_emulate_three_button_mouse, Qcontrol))
! 		     ? controlKey : optionKey) | cmdKey);
! 	}
      }
    return mac_to_emacs_modifiers (mods);
  }
***************
*** 11012,11026 ****
  
    DEFVAR_LISP ("mac-emulate-three-button-mouse",
  	       &Vmac_emulate_three_button_mouse,
!     doc: /* Specify a way of three button mouse emulation.
! The value can be nil, t, or the symbol `reverse'.
! nil means that no emulation should be done and the modifiers should be
! placed on the mouse-1 event.
  t means that when the option-key is held down while pressing the mouse
  button, the click will register as mouse-2 and while the command-key
! is held down, the click will register as mouse-3.
! The symbol `reverse' means that the option-key will register for
! mouse-3 and the command-key will register for mouse-2.  */);
    Vmac_emulate_three_button_mouse = Qnil;
  
  #if USE_CARBON_EVENTS
--- 11031,11052 ----
  
    DEFVAR_LISP ("mac-emulate-three-button-mouse",
  	       &Vmac_emulate_three_button_mouse,
!     doc: /* Specify a way of three button mouse emulation.  
! The value canbe nil, t, or one of the symbols `reverse' or `ctrl'.  
! Non-nil means emulate mouse buttons using modifier keys:  
! 
  t means that when the option-key is held down while pressing the mouse
  button, the click will register as mouse-2 and while the command-key
! is held down, the click will register as mouse-3.  
! 
! `reverse' means that the option-key will register for mouse-3 and the
! command-key will register for mouse-2. 
! 
! `ctrl' means that a click with the control-key held down will register
! as mouse-3, and command-click will register as mouse-2.
! 
! nil means that no emulation should be done and the modifiers should be
! placed on the mouse-1 event. */);
    Vmac_emulate_three_button_mouse = Qnil;
  
  #if USE_CARBON_EVENTS
