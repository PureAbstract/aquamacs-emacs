<html lang="en">
<head>
<title>Compiling Macros - GNU Emacs Lisp Reference Manual</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="GNU Emacs Lisp Reference Manual">
<meta name="generator" content="makeinfo 4.8">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Macros.html#Macros" title="Macros">
<link rel="prev" href="Expansion.html#Expansion" title="Expansion">
<link rel="next" href="Defining-Macros.html#Defining-Macros" title="Defining Macros">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This is edition 2.9 of the GNU Emacs Lisp Reference Manual,

corresponding to Emacs version 22.1.

Copyright (C) 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1998,
1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007  Free Software
Foundation, Inc.

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.2 or any later version published by the Free Software
     Foundation; with the Invariant Sections being ``GNU General Public
     License,'' with the Front-Cover texts being ``A GNU Manual,'' and
     with the Back-Cover Texts as in (a) below.  A copy of the license
     is included in the section entitled ``GNU Free Documentation
     License.''

     (a) The FSF's Back-Cover Text is: ``You have freedom to copy and
     modify this GNU Manual, like GNU software.  Copies published by
     the Free Software Foundation raise funds for GNU development.''
   -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
<link rel="stylesheet" href="aquamacs.css" type="text/css" /></head>
<body>
<div class="node">
<p>
<a name="Compiling-Macros"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="Defining-Macros.html#Defining-Macros">Defining Macros</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Expansion.html#Expansion">Expansion</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Macros.html#Macros">Macros</a>
<hr>
</div>

<h3 class="section">13.3 Macros and Byte Compilation</h3>

<p><a name="index-byte_002dcompiling-macros-713"></a>
  You might ask why we take the trouble to compute an expansion for a
macro and then evaluate the expansion.  Why not have the macro body
produce the desired results directly?  The reason has to do with
compilation.

   <p>When a macro call appears in a Lisp program being compiled, the Lisp
compiler calls the macro definition just as the interpreter would, and
receives an expansion.  But instead of evaluating this expansion, it
compiles the expansion as if it had appeared directly in the program. 
As a result, the compiled code produces the value and side effects
intended for the macro, but executes at full compiled speed.  This would
not work if the macro body computed the value and side effects
itself&mdash;they would be computed at compile time, which is not useful.

   <p>In order for compilation of macro calls to work, the macros must
already be defined in Lisp when the calls to them are compiled.  The
compiler has a special feature to help you do this: if a file being
compiled contains a <code>defmacro</code> form, the macro is defined
temporarily for the rest of the compilation of that file.  To make this
feature work, you must put the <code>defmacro</code> in the same file where it
is used, and before its first use.

   <p>Byte-compiling a file executes any <code>require</code> calls at top-level
in the file.  This is in case the file needs the required packages for
proper compilation.  One way to ensure that necessary macro definitions
are available during compilation is to require the files that define
them (see <a href="Named-Features.html#Named-Features">Named Features</a>).  To avoid loading the macro definition files
when someone <em>runs</em> the compiled program, write
<code>eval-when-compile</code> around the <code>require</code> calls (see <a href="Eval-During-Compile.html#Eval-During-Compile">Eval During Compile</a>).

   </body></html>

