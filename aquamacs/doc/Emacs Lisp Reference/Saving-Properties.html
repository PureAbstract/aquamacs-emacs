<html lang="en">
<head>
<title>Saving Properties - GNU Emacs Lisp Reference Manual</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="GNU Emacs Lisp Reference Manual">
<meta name="generator" content="makeinfo 4.8">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Text-Properties.html#Text-Properties" title="Text Properties">
<link rel="prev" href="Sticky-Properties.html#Sticky-Properties" title="Sticky Properties">
<link rel="next" href="Lazy-Properties.html#Lazy-Properties" title="Lazy Properties">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This is edition 2.9 of the GNU Emacs Lisp Reference Manual,

corresponding to Emacs version 22.1.

Copyright (C) 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1998,
1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007  Free Software
Foundation, Inc.

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.2 or any later version published by the Free Software
     Foundation; with the Invariant Sections being ``GNU General Public
     License,'' with the Front-Cover texts being ``A GNU Manual,'' and
     with the Back-Cover Texts as in (a) below.  A copy of the license
     is included in the section entitled ``GNU Free Documentation
     License.''

     (a) The FSF's Back-Cover Text is: ``You have freedom to copy and
     modify this GNU Manual, like GNU software.  Copies published by
     the Free Software Foundation raise funds for GNU development.''
   -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
<link rel="stylesheet" href="aquamacs.css" type="text/css" /></head>
<body>
<div class="node">
<p>
<a name="Saving-Properties"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="Lazy-Properties.html#Lazy-Properties">Lazy Properties</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Sticky-Properties.html#Sticky-Properties">Sticky Properties</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Text-Properties.html#Text-Properties">Text Properties</a>
<hr>
</div>

<h4 class="subsection">32.19.7 Saving Text Properties in Files</h4>

<p><a name="index-text-properties-in-files-2619"></a><a name="index-saving-text-properties-2620"></a>
  You can save text properties in files (along with the text itself),
and restore the same text properties when visiting or inserting the
files, using these two hooks:

<div class="defun">
&mdash; Variable: <b>write-region-annotate-functions</b><var><a name="index-write_002dregion_002dannotate_002dfunctions-2621"></a></var><br>
<blockquote><p>This variable's value is a list of functions for <code>write-region</code> to
run to encode text properties in some fashion as annotations to the text
being written in the file.  See <a href="Writing-to-Files.html#Writing-to-Files">Writing to Files</a>.

        <p>Each function in the list is called with two arguments: the start and
end of the region to be written.  These functions should not alter the
contents of the buffer.  Instead, they should return lists indicating
annotations to write in the file in addition to the text in the
buffer.

        <p>Each function should return a list of elements of the form
<code>(</code><var>position</var><code> . </code><var>string</var><code>)</code>, where <var>position</var> is an
integer specifying the relative position within the text to be written,
and <var>string</var> is the annotation to add there.

        <p>Each list returned by one of these functions must be already sorted in
increasing order by <var>position</var>.  If there is more than one function,
<code>write-region</code> merges the lists destructively into one sorted list.

        <p>When <code>write-region</code> actually writes the text from the buffer to the
file, it intermixes the specified annotations at the corresponding
positions.  All this takes place without modifying the buffer. 
</p></blockquote></div>

<div class="defun">
&mdash; Variable: <b>after-insert-file-functions</b><var><a name="index-after_002dinsert_002dfile_002dfunctions-2622"></a></var><br>
<blockquote><p>This variable holds a list of functions for <code>insert-file-contents</code>
to call after inserting a file's contents.  These functions should scan
the inserted text for annotations, and convert them to the text
properties they stand for.

        <p>Each function receives one argument, the length of the inserted text;
point indicates the start of that text.  The function should scan that
text for annotations, delete them, and create the text properties that
the annotations specify.  The function should return the updated length
of the inserted text, as it stands after those changes.  The value
returned by one function becomes the argument to the next function.

        <p>These functions should always return with point at the beginning of
the inserted text.

        <p>The intended use of <code>after-insert-file-functions</code> is for converting
some sort of textual annotations into actual text properties.  But other
uses may be possible. 
</p></blockquote></div>

   <p>We invite users to write Lisp programs to store and retrieve text
properties in files, using these hooks, and thus to experiment with
various data formats and find good ones.  Eventually we hope users
will produce good, general extensions we can install in Emacs.

   <p>We suggest not trying to handle arbitrary Lisp objects as text property
names or values&mdash;because a program that general is probably difficult
to write, and slow.  Instead, choose a set of possible data types that
are reasonably flexible, and not too hard to encode.

   <p>See <a href="Format-Conversion.html#Format-Conversion">Format Conversion</a>, for a related feature.

<!-- ??? In next edition, merge this info Format Conversion. -->
</body></html>

